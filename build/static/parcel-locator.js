!function(){var e,a;window.germanized=window.germanized||{},window.germanized.dhl_parcel_locator=window.germanized.dhl_parcel_locator||{},e=jQuery,(a=window.germanized).dhl_parcel_locator={params:{},parcelShops:[],wrapper:"",init:function(){var r=a.dhl_parcel_locator;r.params=wc_gzd_dhl_parcel_locator_params,r.wrapper=r.params.wrapper,e(document).on("change.dhl",r.wrapper+" #shipping_address_type",r.refreshAddressType).on("change.dhl",r.wrapper+" #shipping_address_1",r.onChangeAddress).on("change.dhl",r.wrapper+" #shipping_address_2",r.onChangeAddress).on("change.dhl",r.wrapper+" #shipping_postcode",r.onChangeAddress).on("change.dhl",r.wrapper+" #shipping_country",r.onChangeAddress).on("change.dhl",r.wrapper+" #ship-to-different-address-checkbox",r.onChangeShipping).on("change.dhl",r.wrapper+" #shipping_country",r.refreshAvailability).on("input.dhl validate.dhl change.dhl",r.wrapper+" #shipping_dhl_postnumber",r.validatePostnumber),e(document.body).on("payment_method_selected",r.triggerCheckoutRefresh),e(document.body).on("updated_checkout",r.afterRefreshCheckout),r.isCheckout()||e(document.body).on("country_to_state_changing",(function(){var e=a.dhl_parcel_locator;setTimeout((function(){e.refreshAddressType()}),500)})),r.refreshAvailability(),r.refreshAddressType()},validatePostnumber:function(a){var r=e(this),o=r.closest(".form-row"),p=a.type;"input"===p&&r.val()&&r.val(r.val().replace(/\D/g,"")),"validate"!==p&&"change"!==p||r.val()&&(r.val(r.val().replace(/\D/g,"")),(r.val().toString().length<6||r.val().toString().length>12)&&o.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-postnumber"))},triggerCheckoutRefresh:function(){e(document.body).trigger("update_checkout")},isCheckout:function(){return a.dhl_parcel_locator.params.is_checkout},afterRefreshCheckout:function(){var r=a.dhl_parcel_locator,o={security:r.params.parcel_locator_data_nonce,action:"woocommerce_gzd_dhl_parcel_locator_refresh_shipping_data"};e.ajax({type:"POST",url:r.params.ajax_url,data:o,success:function(e){r.params.methods=e.methods,r.refreshAvailability()},error:function(e){r.refreshAvailability()},dataType:"json"})},refreshAvailability:function(){var r=a.dhl_parcel_locator,o=r.getShippingMethod(),p=r.getShippingMethodData(o);if(r.isAvailable()){var t=e(r.wrapper+" #shipping_address_type"),d=t.val();r.isCheckout()&&(t.html(""),p&&(e.each(p.address_type_options,(function(a,r){t.append(e("<option/>",{value:a,text:r}))})),t.find('option[value="'+d+'"]').length>0&&t.find('option[value="'+d+'"]').prop("selected",!0),t.trigger("change"))),t.find("option").length>0?e(r.wrapper+" #shipping_address_type_field").show():e(r.wrapper+" #shipping_address_type_field").hide(),e(document.body).trigger("woocommerce_gzd_dhl_location_available_pickup_types_changed")}else e(r.wrapper+" #shipping_address_type").val("regular").trigger("change"),e(r.wrapper+" #shipping_address_type_field").hide()},onChangeShipping:function(){var r=a.dhl_parcel_locator;e(this).is(":checked")&&(r.refreshAvailability(),r.isEnabled()&&r.refreshAddressType())},onChangeAddress:function(){var e=a.dhl_parcel_locator;e.isEnabled()&&e.formatAddress()},formatAddress:function(){var r=!1,o=a.dhl_parcel_locator,p=e(o.wrapper+" #shipping_country").val(),t=o.getPickupFieldKey(p);e(o.wrapper+" #shipping_"+t).val().length>0&&(r=!0),r&&o.validateAddress({address_1:e(o.wrapper+" #shipping_address_1").val(),address_2:e(o.wrapper+" #shipping_address_2").val(),country:p,postcode:e(o.wrapper+" #shipping_postcode").val()}),o.refreshCustomerNumberStatus()},addressIsPackstation:function(){var r=a.dhl_parcel_locator;return e(r.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(r.params.i18n.packstation.toLowerCase())>=0},addressIsPostOffice:function(){var r=a.dhl_parcel_locator;return e(r.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(r.params.i18n.postoffice.toLowerCase())>=0},addressIsParcelShop:function(){var r=a.dhl_parcel_locator;return e(r.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(r.params.i18n.parcelshop.toLowerCase())>=0},shippingMethodSupportsPickupType:function(r,o){var p=a.dhl_parcel_locator.getShippingMethodData(r),t=!1;return p&&-1!==e.inArray(o,p.supports)&&(t=!0),t},customerNumberIsMandatory:function(e){var r=a.dhl_parcel_locator;return!(!r.isEnabled()||("DE"!==e||!r.addressIsPackstation())&&(r.addressIsParcelShop()||r.addressIsPostOffice(),1))},refreshCustomerNumberStatus:function(){var r=a.dhl_parcel_locator,o=e(r.wrapper+" #shipping_dhl_postnumber_field");r.customerNumberIsMandatory(e(r.wrapper+" #shipping_country").val())?(o.find("label span").length&&o.find("label span").hasClass("required")||o.find("label").append(' <span class="required">*</span>'),o.find("label span.optional").hide(),o.addClass("validate-required")):(o.find("label span.required").remove(),o.find("label span.optional").show(),o.removeClass("validate-required woocommerce-invalid woocommerce-invalid-required-field"))},validateAddress:function(r){var o=a.dhl_parcel_locator,p={action:"woocommerce_gzd_dhl_parcel_locator_validate_address",address:r,security:o.params.parcel_locator_nonce},t=e(o.wrapper+" #shipping_address_1"),d=e(o.wrapper+" #shipping_address_2"),i=e(o.wrapper+" #shipping_"+o.getPickupFieldKey(r.country)).closest(".form-row");i.removeClass("woocommerce-validated"),i.removeClass("woocommerce-invalid"),e.ajax({type:"POST",url:o.params.ajax_url,data:p,success:function(a){if(a.valid)t.val(a.address_1),d.length>0&&d.val(a.address_2),i.addClass("woocommerce-validated"),o.refreshCustomerNumberStatus();else{if(a.messages){var r=o.isCheckout()?e("form.checkout"):e(o.wrapper).closest("form");if(e(".woocommerce-NoticeGroup-pickup").remove(),a.messages){r.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-pickup"><ul class="woocommerce-error" role="alert">'+a.messages+"</ul></div>");var p=e(".woocommerce-NoticeGroup-woocommerce-NoticeGroup-pickup, .woocommerce-NoticeGroup-checkout");p.length||(p=r),e.scroll_to_notices(p)}}i.addClass("woocommerce-invalid")}},error:function(e){},dataType:"json"})},getShippingMethodData:function(e){var r=a.dhl_parcel_locator;return!!r.params.methods.hasOwnProperty(e)&&r.params.methods[e]},getPickupFieldKey:function(e){var r=a.dhl_parcel_locator;return r.params.pickup_address_field_keys.hasOwnProperty(e)?r.params.pickup_address_field_keys[e]:"address_1"},refreshAddressType:function(){var r,o=a.dhl_parcel_locator,p=e(o.wrapper+" #shipping_country").val(),t=o.getPickupFieldKey(p),d=e(o.wrapper+" #shipping_"+t+"_field"),i=e(o.wrapper+" #shipping_"+t),s=o.getShippingMethod(),l=o.getShippingMethodData(s);i.val(),e(o.wrapper+" #shipping_dhl_postnumber_field").hide(),e(o.wrapper+" :input[data-label-dhl]").each((function(){var a=e(this),o=a.closest(".form-row");a.data("label-regular")&&(r=o.find("label span, label abbr"),o.find("label").html(a.data("label-regular")+" "),o.find("label").append(r)),a.data("placeholder-regular")&&a.attr("placeholder",a.data("placeholder-regular")),o.find(".dhl-desc").remove()})),o.isEnabled()&&(l&&(i.data("label-dhl",l.street_label),i.data("placeholder-dhl",l.street_placeholder),i.data("desc-dhl",l.finder_button)),"DE"===p&&(e(o.wrapper+" #shipping_dhl_postnumber_field").show(),o.refreshCustomerNumberStatus()),i.data("label-dhl")&&(r=d.find("label span, label abbr"),d.find("label").html(i.data("label-dhl")+" "),d.find("label").append(r)),i.data("placeholder-dhl")&&i.attr("placeholder",i.data("placeholder-dhl")),i.data("desc-dhl")&&(d.find(".dhl-desc").remove(),d.find(".woocommerce-input-wrapper").after('<p class="desc dhl-desc">'+i.data("desc-dhl")+"</p>")))},isEnabled:function(){var r=a.dhl_parcel_locator;return r.isAvailable()&&"dhl"===e(r.wrapper+" #shipping_address_type").val()},getPaymentMethod:function(){var a=e(".payment_methods .input-radio:checked");return a?a.val():""},getShippingMethod:function(a){var r,o="",p=a||!0;return e("select.shipping_method").length>0?o=e("select.shipping_method").val():e('input[name^="shipping_method"]:checked').length>0?o=e('input[name^="shipping_method"]:checked').val():e('input[name^="shipping_method"][type="hidden"]').length>0&&(o=e('input[name^="shipping_method"][type="hidden"]').val()),p?void 0!==o&&o.length>0&&(r=o.split(":")).length<=1&&(o+=":0"):void 0!==o&&o.length>0&&(r=o.split(":")).length>0&&(o=r[0]),o},pickupTypeIsAvailable:function(e){var r=a.dhl_parcel_locator,o=r.getShippingMethod(),p=!0;return r.shippingMethodSupportsPickupType(o,e)||(p=!1),p},isAvailable:function(){var r=a.dhl_parcel_locator,o=e(r.wrapper+" #shipping_country").val(),p=r.getShippingMethod(),t=r.getPaymentMethod(),d=r.getShippingMethodData(p),i=!0;return-1!==e.inArray(t,r.params.excluded_gateways)&&(i=!1),-1===e.inArray(o,r.params.supported_countries)&&(i=!1),r.isCheckout()&&(d&&0!==d.supports.length||(i=!1)),i}},e(document).ready((function(){a.dhl_parcel_locator.init()})),((window.germanizedShipments=window.germanizedShipments||{}).static=window.germanizedShipments.static||{})["parcel-locator"]={}}();