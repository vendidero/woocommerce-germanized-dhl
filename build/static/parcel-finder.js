!function(){var e,a;window.germanized=window.germanized||{},window.germanized.dhl_parcel_finder=window.germanized.dhl_parcel_finder||{},e=jQuery,(a=window.germanized).dhl_parcel_finder={params:{},parcelShops:[],wrapper:"",init:function(){var r=a.dhl_parcel_finder;r.params=wc_gzd_dhl_parcel_finder_params,r.wrapper=r.params.wrapper,e(document).on("click",".gzd-dhl-parcel-shop-modal",r.openModal).on("click","#dhl-parcel-finder-wrapper .dhl-parcel-finder-close",r.closeModal).on("submit","#dhl-parcel-finder-wrapper #dhl-parcel-finder-form",r.onSubmit).on("click","#dhl-parcel-finder-wrapper .dhl-retry-search",r.onSubmit).on("click","#dhl-parcel-finder-wrapper .dhl-parcelshop-select-btn",r.onSelectShop),e(document.body).on("woocommerce_gzd_dhl_location_available_pickup_types_changed",r.onChangeAvailablePickupTypes)},onChangeAvailablePickupTypes:function(){var r=a.dhl_parcel_finder,p=a.dhl_parcel_locator,n=r.getModal(),i=p.getShippingMethod(),l=p.getShippingMethodData(i);l&&(n.find(".finder-pickup-type").addClass("hidden"),e.each(l.supports,(function(e,a){var r=n.find('.finder-pickup-type[data-pickup_type="'+a+'"]');r.find("input[type=checkbox]").prop("checked",!0),r.removeClass("hidden")})))},openModal:function(){var r=a.dhl_parcel_finder,p=r.getModal(),n=e(r.wrapper+" #shipping_country").val().length>0?e(r.wrapper+" #shipping_country").val():e(r.wrapper+" #billing_country").val();p.find("#dhl-parcelfinder-country").val(n);var i=e(r.wrapper+" #shipping_postcode").val().length>0?e(r.wrapper+" #shipping_postcode").val():e(r.wrapper+" #billing_postcode").val();p.find("#dhl-parcelfinder-postcode").val(i);var l=e(r.wrapper+" #shipping_city").val().length>0?e(r.wrapper+" #shipping_city").val():e(r.wrapper+" #billing_city").val();return p.find("#dhl-parcelfinder-city").val(l),p.addClass("open"),p.find("#dhl-parcel-finder-form").submit(),!1},closeModal:function(){return a.dhl_parcel_finder.getModal().removeClass("open"),!1},getModal:function(){return e("#dhl-parcel-finder-wrapper")},doAjax:function(r,p,n,i){var l=a.dhl_parcel_finder;n=n||l.onAjaxSuccess,i=i||l.onAjaxError,r.hasOwnProperty("security")||(r.security=l.params.parcel_finder_nonce),p.find("#dhl-parcel-finder-map").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),p.find(".notice-wrapper").empty(),e.ajax({type:"POST",url:l.params.ajax_url,data:r,success:function(a){a.success?(p.find("#dhl-parcel-finder-map").unblock(),n.apply(p,[a])):(i.apply(p,[a]),p.find("#dhl-parcel-finder-map").unblock(),a.hasOwnProperty("message")?l.addNotice(a.message,"error",p):a.hasOwnProperty("messages")&&e.each(a.messages,(function(e,a){l.addNotice(a,"error",p)})))},error:function(e){},dataType:"json"})},onAjaxSuccess:function(e){},onAjaxError:function(e){},getFormData:function(a){var r={};return e.each(a.serializeArray(),(function(a,p){-1!==p.name.indexOf("[]")?(p.name=p.name.replace("[]",""),r[p.name]=e.makeArray(r[p.name]),r[p.name].push(p.value)):r[p.name]=p.value})),r},onSubmit:function(e){var r=a.dhl_parcel_finder,p=a.dhl_parcel_locator,n=r.getModal().find("#dhl-parcel-finder"),i=n.find("form"),l=r.getFormData(i);return l.action="woocommerce_gzd_dhl_parcelfinder_search",l.is_checkout=p.isCheckout()?"yes":"no",r.doAjax(l,n,r.onSubmitSuccess),!1},onSubmitSuccess:function(e){var r=a.dhl_parcel_finder;e.parcel_shops&&(r.parcelShops=e.parcel_shops,"object"==typeof google&&"object"==typeof google.maps?r.updateMap():r.loadMapsAPI())},loadMapsAPI:function(){var e=a.dhl_parcel_finder;e.addScript("https://maps.googleapis.com/maps/api/js?key="+e.params.api_key,e.updateMap)},addScript:function(e,a){var r=document.createElement("script");a&&(r.onload=a),r.type="text/javascript",r.src=e,document.body.appendChild(r)},updateMap:function(){var r=a.dhl_parcel_finder,p=r.parcelShops,n={lat:p[0].place.geo.latitude,lng:p[0].place.geo.longitude},i=new google.maps.Map(document.getElementById("dhl-parcel-finder-map"),{zoom:13,center:n}),l=[];e.each(p,(function(e,a){var p={lat:a.place.geo.latitude,lng:a.place.geo.longitude},n=r.params.packstation_icon,o=r.params.i18n.packstation;switch(a.gzd_type){case"parcelshop":n=r.params.parcelshop_icon,o=r.params.i18n.branch;break;case"postoffice":n=r.params.postoffice_icon,o=r.params.i18n.branch}var c=new google.maps.InfoWindow({content:a.html_content,maxWidth:300});l.push(c);var d=new google.maps.Marker({position:p,map:i,title:o,animation:google.maps.Animation.DROP,icon:n});d.addListener("click",(function(){!function(){for(var e=0;e<l.length;e++)l[e].close()}(),c.open(i,d)}))}))},onSelectShop:function(){var r=a.dhl_parcel_finder,p=e(this).attr("id"),n=e(r.wrapper+" #shipping_address_type"),i=e(r.wrapper+" #shipping_country").val(),l=a.dhl_parcel_locator.getPickupFieldKey(i);e.each(r.parcelShops,(function(a,o){if(o.gzd_result_id===p){var c="packstation"===o.gzd_type;return e(r.wrapper+" #shipping_first_name").val(e(r.wrapper+" #shipping_first_name").val().length>0?e(r.wrapper+" #shipping_first_name").val():e(r.wrapper+" #billing_first_name").val()),e(r.wrapper+" #shipping_last_name").val(e(r.wrapper+" #shipping_last_name").val().length>0?e(r.wrapper+" #shipping_last_name").val():e(r.wrapper+" #billing_last_name").val()),e(r.wrapper+" #shipping_"+l).val(o.gzd_name),"DE"===i?e(r.wrapper+" #shipping_address_2").val(""):e(r.wrapper+" #shipping_address_1").val(o.place.address.streetAddress),e(r.wrapper+" #shipping_postcode").val(o.place.address.postalCode),e(r.wrapper+" #shipping_city").val(o.place.address.addressLocality),n.val("dhl").trigger("change"),r.closeModal(),"DE"===i&&c&&""===e(r.wrapper+" #shipping_dhl_postnumber").val()&&e(r.wrapper+" #shipping_dhl_postnumber").focus(),!0}}))},addNotice:function(e,a,r){r.find(".notice-wrapper").append('<div class="notice notice-'+a+'"><p>'+e+"</p></div>")}},e(document).ready((function(){a.dhl_parcel_finder.init()})),((window.germanizedShipments=window.germanizedShipments||{}).static=window.germanizedShipments.static||{})["parcel-finder"]={}}();